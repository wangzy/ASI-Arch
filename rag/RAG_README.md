# åŸºäºOpenSearchçš„RAGæœåŠ¡

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªåŸºäºOpenSearchçš„æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æœåŠ¡ï¼Œä¸“é—¨ç”¨äºæœç´¢å’Œæ£€ç´¢è®¤çŸ¥æ•°æ®åº“ä¸­çš„å®éªŒè§¦å‘æ¨¡å¼ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ” **è¯­ä¹‰æœç´¢**: åŸºäº`EXPERIMENTAL_TRIGGER_PATTERNS`å­—æ®µè¿›è¡Œå‘é‡ç›¸ä¼¼åº¦æœç´¢
- ğŸ“„ **æ–‡æ¡£ç®¡ç†**: æ¯ä¸ªè®¤çŸ¥æ´å¯Ÿä½œä¸ºç‹¬ç«‹æ–‡æ¡£ï¼ŒåŒ…å«è®ºæ–‡æ¥æºä¿¡æ¯
- ğŸš€ **REST API**: æä¾›å®Œæ•´çš„HTTP APIæ¥å£
- ğŸ³ **å®¹å™¨åŒ–éƒ¨ç½²**: ä½¿ç”¨Docker Composeä¸€é”®éƒ¨ç½²OpenSearch
- ğŸ“Š **ç»Ÿè®¡åˆ†æ**: æä¾›ç´¢å¼•ç»Ÿè®¡å’Œæœç´¢åˆ†æåŠŸèƒ½

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP API    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯åº”ç”¨    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚   Flask API     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚   (rag_api.py)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   RAG Service   â”‚
                                    â”‚  (rag_service)  â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚   OpenSearch    â”‚
                                    â”‚   (å‘é‡æ•°æ®åº“)   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ç³»ç»Ÿå·²å®‰è£…ï¼š
- Python 3.8+
- Docker å’Œ Docker Compose
- è‡³å°‘4GBå¯ç”¨å†…å­˜

### 2. å®‰è£…ä¾èµ–

```bash
cd mad-lab
pip3 install -r requirements_rag.txt
```

### 3. å¯åŠ¨æœåŠ¡

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
chmod +x start_rag_service.sh
./start_rag_service.sh
```

#### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å¯åŠ¨

```bash
# å¯åŠ¨OpenSearch
docker-compose up -d opensearch

# ç­‰å¾…OpenSearchå¯åŠ¨å®Œæˆ
sleep 30

# å¯åŠ¨RAG APIæœåŠ¡
python3 rag_api.py
```

### 4. éªŒè¯æœåŠ¡

è®¿é—® http://localhost:5000 æŸ¥çœ‹APIæ–‡æ¡£

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:5000/health

# è·å–ç»Ÿè®¡ä¿¡æ¯
curl http://localhost:5000/stats
```

## API æ¥å£

### æœç´¢ç›¸ä¼¼æ¨¡å¼

```bash
POST /search
Content-Type: application/json

{
    "query": "æ¨¡å‹åœ¨é•¿åºåˆ—ä¸Šè¡¨ç°ä¸ä½³",
    "k": 5,
    "similarity_threshold": 0.6
}
```

### è·å–è®ºæ–‡æ–‡æ¡£

```bash
GET /paper/arxiv.org_abs_1706.03762
```

### è·å–ç»Ÿè®¡ä¿¡æ¯

```bash
GET /stats
```

## ä½¿ç”¨ç¤ºä¾‹

### Pythonå®¢æˆ·ç«¯

```python
import requests

# æœç´¢ç›¸ä¼¼æ¨¡å¼
response = requests.post('http://localhost:5000/search', json={
    "query": "attention mechanism computational complexity",
    "k": 3,
    "similarity_threshold": 0.7
})

results = response.json()
for result in results['results']:
    print(f"è®ºæ–‡: {result['paper_key']}")
    print(f"ç›¸ä¼¼åº¦: {result['score']:.3f}")
    print(f"è§¦å‘æ¨¡å¼: {result['experimental_trigger_patterns']}")
    print("-" * 50)
```

### æµ‹è¯•å®¢æˆ·ç«¯

è¿è¡Œå†…ç½®çš„æµ‹è¯•å®¢æˆ·ç«¯ï¼š

```bash
python3 test_rag_client.py
```

## æ•°æ®ç»“æ„

### è¾“å…¥æ•°æ®æ ¼å¼

æ¯ä¸ªJSONæ–‡ä»¶åŒ…å«å¤šä¸ªè®¾è®¡æ´å¯Ÿå¯¹è±¡ï¼š

```json
[
    {
        "DESIGN_INSIGHT": "è®¾è®¡æ´å¯Ÿæ ‡é¢˜",
        "EXPERIMENTAL_TRIGGER_PATTERNS": "å®éªŒè§¦å‘æ¨¡å¼æè¿°...",
        "BACKGROUND": "èƒŒæ™¯ä¿¡æ¯...",
        "ALGORITHMIC_INNOVATION": "ç®—æ³•åˆ›æ–°...",
        "IMPLEMENTATION_GUIDANCE": "å®ç°æŒ‡å¯¼...",
        "DESIGN_AI_INSTRUCTIONS": "AIè®¾è®¡æŒ‡ä»¤..."
    }
]
```

### ç´¢å¼•æ•°æ®ç»“æ„

æ¯ä¸ªæ–‡æ¡£åŒ…å«ï¼š
- `paper_key`: è®ºæ–‡æ ‡è¯†ï¼ˆJSONæ–‡ä»¶åï¼‰
- `design_insight`: è®¾è®¡æ´å¯Ÿ
- `experimental_trigger_patterns`: å®éªŒè§¦å‘æ¨¡å¼ï¼ˆç”¨äºembeddingï¼‰
- `background`: èƒŒæ™¯ä¿¡æ¯
- `algorithmic_innovation`: ç®—æ³•åˆ›æ–°
- `implementation_guidance`: å®ç°æŒ‡å¯¼
- `design_ai_instructions`: AIè®¾è®¡æŒ‡ä»¤
- `embedding`: å‘é‡åµŒå…¥ï¼ˆ384ç»´ï¼‰

## é…ç½®è¯´æ˜

### OpenSearché…ç½®

- ä¸»æœº: localhost:9200
- ç´¢å¼•å: cognition_rag
- åˆ†ç‰‡æ•°: 1
- å‰¯æœ¬æ•°: 0
- ç¦ç”¨å®‰å…¨æ’ä»¶

### åµŒå…¥æ¨¡å‹é…ç½®

- æ¨¡å‹: all-MiniLM-L6-v2
- ç»´åº¦: 384
- è¯­è¨€: å¤šè¯­è¨€æ”¯æŒ

### APIé…ç½®

- ç«¯å£: 5000
- è·¨åŸŸ: å·²å¯ç”¨
- æœ€å¤§ç»“æœæ•°: 50

## æ€§èƒ½ä¼˜åŒ–

### æœç´¢ä¼˜åŒ–

- ä½¿ç”¨KNNå‘é‡æœç´¢
- å¯è°ƒèŠ‚ç›¸ä¼¼åº¦é˜ˆå€¼
- æ”¯æŒç»“æœæ•°é‡é™åˆ¶

### å†…å­˜ä¼˜åŒ–

- OpenSearchå †å†…å­˜: 512MB
- æ’é™¤åµŒå…¥å‘é‡ä»æœç´¢ç»“æœ
- ä½¿ç”¨æµå¼å¤„ç†å¤§æ–‡ä»¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **OpenSearchå¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥å†…å­˜ä½¿ç”¨
   docker stats opensearch-rag
   
   # é‡å¯æœåŠ¡
   docker-compose restart opensearch
   ```

2. **APIæœåŠ¡è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥OpenSearchçŠ¶æ€
   curl http://localhost:9200/_cluster/health
   
   # é‡æ–°åˆå§‹åŒ–RAGæœåŠ¡
   curl -X POST http://localhost:5000/reinit
   ```

3. **æœç´¢ç»“æœä¸ºç©º**
   - æ£€æŸ¥ç›¸ä¼¼åº¦é˜ˆå€¼æ˜¯å¦è¿‡é«˜
   - ç¡®è®¤æ•°æ®å·²æ­£ç¡®ç´¢å¼•
   - å°è¯•ä½¿ç”¨ä¸åŒçš„æŸ¥è¯¢è¯

### æ—¥å¿—æŸ¥çœ‹

```bash
# OpenSearchæ—¥å¿—
docker logs opensearch-rag

# APIæœåŠ¡æ—¥å¿—
# ç›´æ¥åœ¨ç»ˆç«¯æŸ¥çœ‹è¾“å‡ºæ—¥å¿—
```

## æ‰©å±•åŠŸèƒ½

### è‡ªå®šä¹‰åµŒå…¥æ¨¡å‹

ä¿®æ”¹ `rag_service.py` ä¸­çš„æ¨¡å‹é…ç½®ï¼š

```python
rag_service = OpenSearchRAGService(
    embedding_model="your-custom-model"
)
```

### æ·»åŠ æ–°çš„æœç´¢å­—æ®µ

æ‰©å±•ç´¢å¼•æ˜ å°„ä»¥åŒ…å«å…¶ä»–å­—æ®µçš„å‘é‡æœç´¢ã€‚

### å¤šè¯­è¨€æ”¯æŒ

é…ç½®é€‚åˆç›®æ ‡è¯­è¨€çš„åˆ†æå™¨å’ŒåµŒå…¥æ¨¡å‹ã€‚

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åˆ›å»º Issue æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…ã€‚ 